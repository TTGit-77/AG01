{% extends 'base.html' %}

{% block content %}
<h2 class="mb-4">Admin Dashboard</h2>
<div class="mb-3 text-end">
    <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#adminLoginModal">Admin Login</button>
    <button class="btn btn-outline-success me-2" data-bs-toggle="modal" data-bs-target="#adminRegisterModal">Create Admin Account</button>
    <a href="{{ url_for('admin_logout') }}" class="btn btn-outline-danger">Logout</a>
    <button class="btn btn-gradient ms-2" data-bs-toggle="modal" data-bs-target="#addMovieModal">+ Add Movie</button>
</div>
<!-- Admin Login Modal -->
<div class="modal fade" id="adminLoginModal" tabindex="-1" aria-labelledby="adminLoginModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content bg-dark text-light">
      <form method="POST" action="{{ url_for('admin_login') }}">
        <div class="modal-header">
          <h5 class="modal-title" id="adminLoginModalLabel">Admin Login</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" name="username" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" name="password" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Login</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Admin Register Modal -->
<div class="modal fade" id="adminRegisterModal" tabindex="-1" aria-labelledby="adminRegisterModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content bg-dark text-light">
      <form method="POST" action="{{ url_for('admin_register') }}">
        <div class="modal-header">
          <h5 class="modal-title" id="adminRegisterModalLabel">Create Admin Account</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" name="username" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" name="password" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success w-100">Create Account</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Add Movie Modal -->
<div class="modal fade" id="addMovieModal" tabindex="-1" aria-labelledby="addMovieModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content bg-dark text-light">
      <form method="POST" action="{{ url_for('admin_add_movie') }}">
        <div class="modal-header">
          <h5 class="modal-title" id="addMovieModalLabel">Add New Movie</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Title</label>
            <input type="text" class="form-control" name="title" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Director</label>
            <input type="text" class="form-control" name="director" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Release Year</label>
            <input type="number" class="form-control" name="release_year" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Genre</label>
            <input type="text" class="form-control" name="genre" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Rating</label>
            <input type="number" step="0.1" min="0" max="10" class="form-control" name="rating" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Poster URL</label>
            <input type="url" class="form-control" name="poster_url" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-gradient">Add Movie</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="table-responsive">
<table class="table table-dark table-striped align-middle">
    <thead style="background:linear-gradient(90deg,#1a2980,#26d0ce);color:#fff;">
        <tr>
            <th>Poster</th>
            <th>Title</th>
            <th>Genre</th>
            <th>Year</th>
            <th>Director</th>
            <th>Rating</th>
            <th>Showtimes</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for movie in movies %}
        <tr>
            <td><img src="{{ movie.poster_url }}" alt="{{ movie.title }}" style="height:60px;border-radius:6px;"></td>
            <td>{{ movie.title }}</td>
            <td>{{ movie.genre }}</td>
            <td>{{ movie.release_year }}</td>
            <td>{{ movie.director }}</td>
            <td><span class="badge bg-success">â˜… {{ movie.rating }}</span></td>
            <td><a href="{{ url_for('admin_manage_showtimes', movie_id=movie.id) }}" class="btn btn-sm btn-info">Manage Showtimes</a></td>
            <td>
                <!-- Edit Button triggers modal -->
                <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editMovieModal{{ movie.id }}">Edit</button>
                <!-- Delete Button triggers modal -->
                <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteMovieModal{{ movie.id }}">Delete</button>
            </td>
        </tr>
        <!-- Edit Movie Modal -->
        <div class="modal fade" id="editMovieModal{{ movie.id }}" tabindex="-1" aria-labelledby="editMovieModalLabel{{ movie.id }}" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content bg-dark text-light">
              <form method="POST" action="{{ url_for('admin_edit_movie', movie_id=movie.id) }}">
                <div class="modal-header">
                  <h5 class="modal-title" id="editMovieModalLabel{{ movie.id }}">Edit Movie</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <div class="mb-3">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-control" name="title" value="{{ movie.title }}" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Director</label>
                    <input type="text" class="form-control" name="director" value="{{ movie.director }}" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Release Year</label>
                    <input type="number" class="form-control" name="release_year" value="{{ movie.release_year }}" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Genre</label>
                    <input type="text" class="form-control" name="genre" value="{{ movie.genre }}" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Rating</label>
                    <input type="number" step="0.1" min="0" max="10" class="form-control" name="rating" value="{{ movie.rating }}" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Poster URL</label>
                    <input type="url" class="form-control" name="poster_url" value="{{ movie.poster_url }}" required>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-gradient">Save Changes</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <!-- Delete Movie Modal -->
        <div class="modal fade" id="deleteMovieModal{{ movie.id }}" tabindex="-1" aria-labelledby="deleteMovieModalLabel{{ movie.id }}" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content bg-dark text-light">
              <form method="POST" action="{{ url_for('admin_delete_movie', movie_id=movie.id) }}">
                <div class="modal-header">
                  <h5 class="modal-title" id="deleteMovieModalLabel{{ movie.id }}">Delete Movie</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <p>Are you sure you want to delete <strong>{{ movie.title }}</strong>? This cannot be undone.</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-danger">Delete</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
{% endblock %}
