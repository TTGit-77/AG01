{% extends 'base.html' %}

{% block content %}
<div class="d-flex flex-wrap align-items-center justify-content-between mb-4">
  <h2 class="mb-0">My Bookings</h2>
  <form method="get" class="ms-auto" style="min-width:180px;">
    <select name="month" class="form-select" onchange="this.form.submit()">
      <option value="" {% if not selected_month %}selected{% endif %}>All Months</option>
      {% for m in all_months %}
        <option value="{{ m }}" {% if selected_month == m %}selected{% endif %}>{{ m }}</option>
      {% endfor %}
    </select>
  </form>
</div>
{% if bookings %}
<div class="row g-4 justify-content-center">
  <form method="POST" action="{{ url_for('delete_multiple_bookings') }}">
  <div class="row g-4 justify-content-center">
    {% for booking in bookings %}
    <div class="col-12 col-md-10 col-lg-8">
      <div class="ticket-card d-flex flex-row flex-wrap align-items-center shadow-sm mb-3">
        <div class="ticket-poster p-3 d-flex align-items-center justify-content-center">
          <img src="{{ booking.showtime.movie.poster_url }}" alt="{{ booking.showtime.movie.title }}" class="rounded-3" style="height:120px;width:auto;max-width:90px;object-fit:cover;background:#e3f0ff;box-shadow:0 2px 12px #26d0ce22;">
        </div>
        <div class="ticket-details flex-grow-1 p-3">
          <h5 class="mb-1 fw-bold text-gradient">{{ booking.showtime.movie.title }}</h5>
          <div class="mb-2 text-muted" style="font-size:1.1rem;">
            <span class="me-3"><i class="bi bi-calendar-event"></i> {{ booking.showtime.show_date }}</span>
            <span class="me-3"><i class="bi bi-clock"></i> {{ booking.showtime.show_time }}</span>
            <span><i class="bi bi-film"></i> Screen {{ booking.showtime.screen }}</span>
          </div>
          <div class="mb-2">
            <span class="badge bg-info text-dark me-2">Seats: {{ booking.seats }}</span>
            <span class="badge bg-success">Booked: {{ booking.booking_time.strftime('%Y-%m-%d %H:%M') }}</span>
          </div>
        </div>
        {% set showtime_dt = booking.showtime.show_date + ' ' + booking.showtime.show_time %}
        {% if showtime_dt < now %}
        <div class="form-check ms-auto">
          <input class="form-check-input" type="checkbox" name="delete_ids" value="{{ booking.id }}" id="delete_{{ booking.id }}">
          <label class="form-check-label text-danger" for="delete_{{ booking.id }}">
            Old Ticket
          </label>
        </div>
        {% endif %}
        <div class="ticket-edge d-none d-md-block"></div>
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="text-center mt-4">
    <button type="submit" class="btn btn-danger px-4" onclick="return confirm('Delete selected old tickets?');">
      <i class="bi bi-trash"></i> Delete Selected
    </button>
  </div>
</form>
</div>
{% else %}
<p>You have not booked any tickets yet.</p>
{% endif %}

<style>
.ticket-card {
  background: #fff;
  border-radius: 1.5rem;
  border: 1.5px dashed #26d0ce;
  position: relative;
  overflow: hidden;
  min-height: 130px;
  transition: box-shadow .18s;
}
.ticket-card:hover {
  box-shadow: 0 8px 32px 0 #26d0ce22;
}
.ticket-poster {
  min-width: 110px;
  border-right: 1.5px dashed #e6eaf1;
  background: linear-gradient(135deg,#e3f0ff 60%,#f7fcff 100%);
}
.ticket-details {
  flex: 1 1 0%;
}
.text-gradient {
  background: linear-gradient(90deg,#26d0ce 10%,#1a2980 90%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.ticket-edge {
  width: 32px;
  background: repeating-linear-gradient(135deg,#26d0ce22 0 8px,#fff 8px 16px);
  height: 100%;
  position: absolute;
  right: 0;
  top: 0;
}
</style>
{% endblock %}
